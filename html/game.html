<html>
  <style>
  h1 {
  	font-family: "Segoe UI", Frutiger, "Frutiger Linotype", "Dejavu Sans", "Helvetica Neue", Arial, sans-serif;
  	font-size: 49px;
  	font-style: normal;
  	font-variant: normal;
    color: white;
  	font-weight: 500;
  	line-height: 53.9px;
  }
  html {
    background: url("") no-repeat center center fixed;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
  }
  input {
    color: black;
  }
  @font-face {
    font-family: captcha;
    src: url("capcha.ttf");
  }
  </style>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://bootswatch.com/cyborg/bootstrap.min.css" crossorigin="anonymous">
  <!-- Latest compiled and minified JavaScript -->
  <script src="color.js"></script>

  <body style="background-color: transparent;">
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-3"></div>
        <div class="col-xs-6">
          <div class="panel panel-primary">
            <div class="panel-heading"> Options </div>
            <div class="panel-body">
              <table class="table">
                <tr>
                  <td>
                    Your Nickname
                  </td>
                  <td>
                    <input type="text" id="nick" style="color: black">
                  </td>
                </tr>
                <tr>
                  <td>
                    Keys: (Like KeyW or Digit2)
                  </td>
                  <td>
                  </td>
                </tr>
                <tr>
                  <td>
                    Banana
                  </td>
                  <td>
                    <input type="text" id="banana" style="color: black">
                  </td>
                </tr>
                <tr>
                  <td>
                    Lemon
                  </td>
                  <td>
                    <input type="text" id="lemon" style="color: black">
                  </td>
                </tr>
                <tr>
                  <td>
                    Orange
                  </td>
                  <td>
                    <input type="text" id="orange" style="color: black">
                  </td>
                </tr>
                <tr>
                  <td>
                    Lime
                  </td>
                  <td>
                    <input type="text" id="lime" style="color: black">
                  </td>
                </tr>
                <tr>
                  <td>
                    <button class="btn btn-success" onclick="startTheGame()"> Start Game! </button>
                  </td>
                </tr>
            </div>
          </div>
        </div>
        <div class="col-xs-3"></div>
      </div>
    </div>
    <center>
      <h1 class="words" style="font-family: captcha">
      </h1>
      <h1 class="win">
      </h1>
      <h1 class="win2" style="display: none">
      </h1>
      <center class="sboard" style="display: none">
        <ul class="list-group leaderboard" style="width: 30em">
          <!--li class="list-group-item">
            Jay Williams - 39
          </li-->
        </ul>
      </center>
    </center>
  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.6.8/sweetalert2.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.6.8/sweetalert2.min.css">
  <script>
    var mappings = {                                                            // Mappings of keys to fruits
      KeyA: "lemon",                                                            // TODO: Move to config?
      KeyW: "banana",
      KeyS: "lime",
      KeyD: "orange"
    }
    var mappings = {}
    function startTheGame() {
      /*
      This, basically, removes the html loading wheel and starts the game
      */
      $(".container-fluid").css({"display": "none"});
      $("#banana").val() == "" ? mappings.Key1 = "banana" : mappings[$("#banana").val()] = "banana";
      $("#lemon").val() == "" ? mappings.Key2 = "lemon" : mappings[$("#lemon").val()] = "lemon";
      $("#lime").val() == "" ? mappings.Key3 = "lime" : mappings[$("#lime").val()] = "lime";
      $("#orange").val() == "" ? mappings.Key4 = "orange" : mappings[$("#orange").val()] = "orange";
      $(".words").css({"display": "inline"})
      initPic(bases[choose(out)], choose(out))                                  // Set a random background and text
    }
    var bases = {
      lemon: "url('lemons-base.jpg')",                                          // Links to fruits
      banana: "url('banana-base.jpg')",
      lime: "url('lime-base.jpg')",
      orange: "url('orange-base.jpg')"
    }
    var out = [];                                                               // Initialise array of names of fruits
    for (key in bases){                                                         // Go throught fruit objects
      if (!bases.hasOwnProperty(key)) continue;                                 // If the current iteration is on a builtin property to a prototype, skip
      out.push(key)                                                             // Else, add the name of fruit to Array
      color(bases[key].replace("url('", "").replace("')", ""))
      color(bases[key].replace("url('", "").replace("')", ""))                  // HACK: Preload the image so it won't be black on first attempt
    }

    function choose(choices) {                                                  // Makes a random choice from Array, eg. [1,2,5] => 1 or 2 or 5
      var index = Math.floor(Math.random() * choices.length);
      return choices[index];
    }
    function randomMove(elem){                                                  // Takes a jQuery element like $(".words") and puts it in a random location
      var posx = (Math.random() * ($(document).width() - 200)).toFixed();       // Chooses a random x
      var posy = (Math.random() * ($(document).height() - 50)).toFixed();       // Chooses a random Y
      elem.css({                                                                // Sets the css of the element
        'position':'absolute',                                                  // To the absolute position of x and y
        'left':posx+'px',
        'top':posy+'px',
        'display':'inline'
      })
    }
    var current = {};

    function initPic(pic, word) {                                               // Function that sets the background and word
      $("html").css("background-image", pic);                                   // TODO: Random location for word?
      $(".words").text(word);
      $(".words").css("color", color(pic.replace("url('", "").replace("')", "")));
      randomMove($(".words"))                                                   // CHANGED: Now moves text each time
      current.pic = pic;
      current.word = word;
    }

    setTimeout(function () {                                                    // Below code runs after 60 seconds has passed
      $("html").css("background-image", "");                                    // Remove background image
      $("html").css("background-color", "black");                               // Set the background black
      $(".words").remove()                                                      // Remove the current word (ie banana)
      $(".win2").text("You scored " + rounds + " points.")                      // Set winning text
      $(".win2").fadeIn()                                                       // Fade in the winning text
      $(".sboard").fadeIn()                                                     // Fade in the scoreboard
      swal({                                                                    // Create a dialog box:
        title: 'What\'s your name?',
        input: 'text',                                                          // With an input box
        showCancelButton: true,
        confirmButtonText: 'Submit',
        showLoaderOnConfirm: true,
        allowOutsideClick: false
      }).then(function (name) {                                                 // Then when user clicks submit
        $.ajax({                                                                // TODO: This method is a bit hacky HACK
          url: '/add-score/',                                                   // Make a web request to index.js with
          type: 'post',
          data: {},
          headers: {
              "XName": name,                                                    // The data name and score, where name is what the user put in the box
              "XScore": rounds
          },
          dataType: 'json',
          success: function (data) {                                            // Then when that data is successfully sent
              console.info(data);
              $.get("/get-score/", function (d) {                               // Download the updated scoreboard
                var arr = JSON.parse(d);                                        // Parse what we've been given
                for (var i = 0; i < arr.length ; i++) {                         // Go through all the top 20 scores
                  $(".leaderboard").append("<li class='list-group-item'> " + arr[i].name + " - " + arr[i].score + " </li>") // And add them to the leaderboard
                }
              })
          }
        });
      })
      document.onkeyup = function () {};                                        // Finally, set the "onkeyup" function to empty so that users can't continue playing
    }, 21000)

    var rounds = 0;                                                             // Start at 0 wins


    document.onkeyup = function (e) {                                           // When someone lets go of a key
      var mapped = mappings[e.code]                                             // Get the key from "mappings", which was defined earlier
      if(mapped == undefined) return;                                           // If the key isn't registered, forget about it
      if (mapped == current.word) {                                             // If the key is the correct one TODO: Count incorrect keys
        var key = choose(out)                                                   // Then pick two random fruits
        var key2 = choose(out)                                                  // ^
        rounds++;                                                               // Add 1 to the win counter
        initPic(bases[key2], key)                                               // And set the background and text to those random fruits
      }
      else {
      }


    }
  </script>
  </html>
